(window.webpackJsonp=window.webpackJsonp||[]).push([[130],{664:function(s,e,t){"use strict";t.r(e);var n=t(5),a=Object(n.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"默认的配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#默认的配置"}},[s._v("#")]),s._v(" 默认的配置")]),s._v(" "),t("p",[s._v("我们打开"),t("code",[s._v("conf/nginx.conf")]),s._v("这个文件")]),s._v(" "),t("div",{staticClass:"language-conf line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("\nworker_processes  1;\n#user  nobody;\n\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n\n\n    sendfile        on;\n\n    keepalive_timeout  65;\n\n\n    server {\n        listen       80;\n        server_name  localhost;\n\n\n        location / {\n            root   html;\n            index  index.html index.htm;\n        }\n\n\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n    }\n\n}\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br")])]),t("p",[s._v("删除掉注释后，默认的配置如上， 分为"),t("code",[s._v("全局块")]),s._v(" "),t("code",[s._v("events")]),s._v(" 和"),t("code",[s._v("http")]),s._v(",")]),s._v(" "),t("p",[t("code",[s._v("http")]),s._v(" 可以配置多个"),t("code",[s._v("server")]),s._v(" ,"),t("code",[s._v("server")]),s._v("又可以配置多个"),t("code",[s._v("location")])]),s._v(" "),t("p",[t("strong",[s._v("nginx 的配置将是学习 nginx 的重中之重，后面对配置后进行详细的记录")])]),s._v(" "),t("h2",{attrs:{id:"全局模块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#全局模块"}},[s._v("#")]),s._v(" 全局模块")]),s._v(" "),t("h3",{attrs:{id:"user-指令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#user-指令"}},[s._v("#")]),s._v(" user 指令")]),s._v(" "),t("p",[t("code",[s._v("user")]),s._v(" 用于配置 nginx 服务器进程的用户和用户组 ， 默认为 "),t("code",[s._v("nobody")])]),s._v(" "),t("blockquote",[t("p",[s._v("在 nginx 初始化的 config 文件中我们就可以看到这个配置项")])]),s._v(" "),t("p",[s._v("如果我们要更改用户组，比如更改为"),t("code",[s._v("www")]),s._v(" 就可以用以下的配置")]),s._v(" "),t("div",{staticClass:"language-conf line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("user www;\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("添加完后用"),t("code",[s._v("nginx -t")]),s._v(" 来测试下配置是否异常，如果出现异常，比如没有"),t("code",[s._v("www")]),s._v("这个用户组，可以使用"),t("code",[s._v("uesradd www")]),s._v(" 指令来添加一个用户组；")]),s._v(" "),t("p",[s._v("当配置完成后使用"),t("code",[s._v("nginx -s reload")]),s._v("重启服务，再使用 "),t("code",[s._v("ps -ef | grep nginx")]),s._v(" 就可以看到所属用户为"),t("code",[s._v("www")]),s._v("了")]),s._v(" "),t("p",[t("strong",[s._v("配置用户组可以让 nginx 拥有改目录的访问权限")])]),s._v(" "),t("h3",{attrs:{id:"worker-processes-相关指令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#worker-processes-相关指令"}},[s._v("#")]),s._v(" worker_processes 相关指令")]),s._v(" "),t("ol",[t("li",[t("p",[t("code",[s._v("master_process:on | off;")]),s._v(" 是否开启 worker 进程；")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("worker_processes:num | auto ;")]),s._v(" 配置 worker 进程数量，理论上数值越打服务器性能越高，但实际情况是服务器拉了开再多也没用，建议和 cpu 内核数量开的一样多就可以了。")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("demon : on | off ;")]),s._v(" 设置是否以守护进程的方式启动 默认为"),t("code",[s._v("on")])])])]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("守护进程")]),s._v("后服务进程不会随着终端的关闭而关闭。")])]),s._v(" "),t("ol",{attrs:{start:"4"}},[t("li",[t("code",[s._v("pid ： pathfile")]),s._v(" pid 的存放位置 ,默认 "),t("code",[s._v("/usr/local/nginx/logs")])]),s._v(" "),t("li",[t("code",[s._v("err_log")]),s._v(" 错误日志位置")]),s._v(" "),t("li",[t("code",[s._v("include")]),s._v(" 引入其他的配置文件")])]),s._v(" "),t("h2",{attrs:{id:"events-模块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#events-模块"}},[s._v("#")]),s._v(" events 模块")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("accept_mutex: on | off 默认 on;")]),s._v(" 用于配置 nginx 网络连接序列化")])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("惊群问题")]),s._v(" "),t("p",[s._v("这个配置主要解决的"),t("code",[s._v("惊群")]),s._v("问题，意思是当某个时刻用户发送一个请求连接，nginx 是以多进程的工作模式，此时就会有多个进程被同时唤醒争抢任务，当配置为"),t("code",[s._v("on")]),s._v("的时候，就会一个一个唤醒接收，防止进程的争抢")]),s._v(" "),t("p",[t("img",{attrs:{src:"//image.woai996.com/picGo/20210803212502.png",alt:""}})]),s._v(" "),t("p",[s._v("但并非"),t("code",[s._v("on")]),s._v(" 就一定是性能最好的，当同时又很多请求涌来时，把所有进程激活性能可能会比单个排序唤醒更好。")])]),s._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[t("p",[t("code",[s._v("multi_accept : on | off 默认 off;")]),s._v(" 设置工作进程是否可以同时接收多个进程")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("worker_connections : 512(默认) ;")]),s._v(" 配置单个 worker 进程的最大连接数")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("use")]),s._v(" 设置 nginx 选择哪种事件驱动来处理网络消息")])])]),s._v(" "),t("div",{staticClass:"language-config line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("events{\n    accept_mutex on;\n    multi_accept on;\n    worker_connections 1024 ;\n    use epoll ;\n}\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("我们可以在"),t("code",[s._v("nginx.conf")]),s._v("增加以上的代码来配置"),t("code",[s._v("events")]),s._v("模块")]),s._v(" "),t("h2",{attrs:{id:"http-配置模块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#http-配置模块"}},[s._v("#")]),s._v(" http 配置模块")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("MIME-Type")]),s._v(" 指定请求的文件类型")])]),s._v(" "),t("p",[t("code",[s._v("default_type")]),s._v(" 默认的文件文件类型 ，在 nginx"),t("code",[s._v("localtion")]),s._v(" 下增加以下的配置来测试不同的类型")]),s._v(" "),t("div",{staticClass:"language-config line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("location /get_text {\n    default_type text/plain ;\n    return 200 '<h1>this is text</h1>';\n}\n\nlocation /get_html {\n    default_type text/html ;\n    return 200 '<h1>this is html</h1>';\n}\n\nlocation /get_json {\n    default_type application/json ;\n    return 200 '{\"name\":\"张三 \"}';\n}\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[t("p",[t("code",[s._v("sendfile")]),s._v(" 设置nginx服务器是否使用 "),t("code",[s._v("sendfile()")]),s._v(" 来传输文件，可以大大提升处理静态资源性能")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("keepalive_timeout")]),s._v(" 设置长连接的超时时间 默认 "),t("code",[s._v("75s")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("keepalive_requests")]),s._v(" 设置请求多少次之后，结束长连接")])])]),s._v(" "),t("blockquote",[t("p",[s._v("http属于无状态协议，客户端每发送一个tcp请求，服务端响应完毕后就会断开链接 ， 使用"),t("code",[s._v("keepalive")]),s._v("可以增加请求性能")])]),s._v(" "),t("h2",{attrs:{id:"server-和-location-模块"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#server-和-location-模块"}},[s._v("#")]),s._v(" server 和 location 模块")]),s._v(" "),t("p",[t("code",[s._v("server 和 location")]),s._v(" 是nginx中相对重要的配置模块")]),s._v(" "),t("p",[s._v("一个 http中可以包括多个server 模块， 而一个server 模块又可以包括多个location模块")]),s._v(" "),t("h3",{attrs:{id:"server"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#server"}},[s._v("#")]),s._v(" server")]),s._v(" "),t("ol",[t("li",[s._v("listen -> 监听的端口")]),s._v(" "),t("li",[s._v("server_name -> 访问的地址")])]),s._v(" "),t("blockquote",[t("p",[s._v("server_name:listen 构成了我们访问的地址 比如 localhost:8080")])]),s._v(" "),t("ol",{attrs:{start:"3"}},[t("li",[s._v("error_page 错误页面配置")])]),s._v(" "),t("h3",{attrs:{id:"location"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#location"}},[s._v("#")]),s._v(" location")]),s._v(" "),t("ol",[t("li",[s._v("root  -> 页面目录")]),s._v(" "),t("li",[s._v("index -> 首页指向的文件名")])]),s._v(" "),t("h2",{attrs:{id:"自定义服务日志"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自定义服务日志"}},[s._v("#")]),s._v(" 自定义服务日志")]),s._v(" "),t("ol",[t("li",[s._v("access.log 访问成功日志")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",{staticStyle:{"text-align":"center"}},[s._v("语法")]),s._v(" "),t("th",[t("code",[s._v("access_log path [format[buffer=size]]")])])])]),s._v(" "),t("tbody",[t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("默认值")]),s._v(" "),t("td",[s._v("access_log logs/access.log commbined;")])]),s._v(" "),t("tr",[t("td",{staticStyle:{"text-align":"center"}},[s._v("位置")]),s._v(" "),t("td",[s._v("http , server , location")])])])]),s._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[s._v("log_format 指定日志输出的格式")])]),s._v(" "),t("p",[s._v("示例")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("log_format myforat "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'this log is =====>'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \naccess_log  logs/my-access.log  log_format"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("当我们替换为自己的格式时会发现之前的类似于这样的日志不见了，这是因为默认的输出格式中带了许多的nginx内置变量")]),s._v(" "),t("p",[t("code",[s._v('113.246.108.7 - - [03/Aug/2021:22:45:21 +0800] "GET / HTTP/1.1" 304 0 "http://47.107.81.99/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.107 Safari/537.36 Edg/92.0.902.62"')])])])}),[],!1,null,null,null);e.default=a.exports}}]);