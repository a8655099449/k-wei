(window.webpackJsonp=window.webpackJsonp||[]).push([[123],{657:function(s,n,e){"use strict";e.r(n);var t=e(5),a=Object(t.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"默认的配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#默认的配置"}},[s._v("#")]),s._v(" 默认的配置")]),s._v(" "),e("p",[s._v("我们打开"),e("code",[s._v("conf/nginx.conf")]),s._v("这个文件")]),s._v(" "),e("div",{staticClass:"language-conf line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("\nworker_processes  1;\n#user  nobody;\n\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n\n\n    sendfile        on;\n\n    keepalive_timeout  65;\n\n\n    server {\n        listen       80;\n        server_name  localhost;\n\n\n        location / {\n            root   html;\n            index  index.html index.htm;\n        }\n\n\n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   html;\n        }\n    }\n\n}\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br")])]),e("p",[s._v("删除掉注释后，默认的配置如上， 分为"),e("code",[s._v("全局块")]),s._v(" "),e("code",[s._v("events")]),s._v(" 和"),e("code",[s._v("http")]),s._v(",")]),s._v(" "),e("p",[e("code",[s._v("http")]),s._v(" 可以配置多个"),e("code",[s._v("server")]),s._v(" ,"),e("code",[s._v("server")]),s._v("又可以配置多个"),e("code",[s._v("location")])]),s._v(" "),e("p",[e("strong",[s._v("nginx 的配置将是学习 nginx 的重中之重，后面对配置后进行详细的记录")])]),s._v(" "),e("h2",{attrs:{id:"全局模块"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#全局模块"}},[s._v("#")]),s._v(" 全局模块")]),s._v(" "),e("h3",{attrs:{id:"user-指令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#user-指令"}},[s._v("#")]),s._v(" user 指令")]),s._v(" "),e("p",[e("code",[s._v("user")]),s._v(" 用于配置 nginx 服务器进程的用户和用户组 ， 默认为 "),e("code",[s._v("nobody")])]),s._v(" "),e("blockquote",[e("p",[s._v("在 nginx 初始化的 config 文件中我们就可以看到这个配置项")])]),s._v(" "),e("p",[s._v("如果我们要更改用户组，比如更改为"),e("code",[s._v("www")]),s._v(" 就可以用以下的配置")]),s._v(" "),e("div",{staticClass:"language-conf line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("user www;\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("添加完后用"),e("code",[s._v("nginx -t")]),s._v(" 来测试下配置是否异常，如果出现异常，比如没有"),e("code",[s._v("www")]),s._v("这个用户组，可以使用"),e("code",[s._v("uesradd www")]),s._v(" 指令来添加一个用户组；")]),s._v(" "),e("p",[s._v("当配置完成后使用"),e("code",[s._v("nginx -s reload")]),s._v("重启服务，再使用 "),e("code",[s._v("ps -ef | grep nginx")]),s._v(" 就可以看到所属用户为"),e("code",[s._v("www")]),s._v("了")]),s._v(" "),e("p",[e("strong",[s._v("配置用户组可以让 nginx 拥有改目录的访问权限")])]),s._v(" "),e("h3",{attrs:{id:"worker-processes-相关指令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#worker-processes-相关指令"}},[s._v("#")]),s._v(" worker_processes 相关指令")]),s._v(" "),e("ol",[e("li",[e("p",[e("code",[s._v("master_process:on | off;")]),s._v(" 是否开启 worker 进程；")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("worker_processes:num | auto ;")]),s._v(" 配置 worker 进程数量，理论上数值越打服务器性能越高，但实际情况是服务器拉了开再多也没用，建议和 cpu 内核数量开的一样多就可以了。")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("demon : on | off ;")]),s._v(" 设置是否以守护进程的方式启动 默认为"),e("code",[s._v("on")])])])]),s._v(" "),e("blockquote",[e("p",[e("code",[s._v("守护进程")]),s._v("后服务进程不会随着终端的关闭而关闭。")])]),s._v(" "),e("ol",{attrs:{start:"4"}},[e("li",[e("code",[s._v("pid ： pathfile")]),s._v(" pid 的存放位置 ,默认 "),e("code",[s._v("/usr/local/nginx/logs")])]),s._v(" "),e("li",[e("code",[s._v("err_log")]),s._v(" 错误日志位置")]),s._v(" "),e("li",[e("code",[s._v("include")]),s._v(" 引入其他的配置文件")])]),s._v(" "),e("h2",{attrs:{id:"events-模块"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#events-模块"}},[s._v("#")]),s._v(" events 模块")]),s._v(" "),e("ol",[e("li",[e("code",[s._v("accept_mutex: on | off 默认 on;")]),s._v(" 用于配置 nginx 网络连接序列化")])]),s._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("惊群问题")]),s._v(" "),e("p",[s._v("这个配置主要解决的"),e("code",[s._v("惊群")]),s._v("问题，意思是当某个时刻用户发送一个请求连接，nginx 是以多进程的工作模式，此时就会有多个进程被同时唤醒争抢任务，当配置为"),e("code",[s._v("on")]),s._v("的时候，就会一个一个唤醒接收，防止进程的争抢")]),s._v(" "),e("p",[e("img",{attrs:{src:"//image.woai996.com/picGo/20210803212502.png",alt:""}})]),s._v(" "),e("p",[s._v("但并非"),e("code",[s._v("on")]),s._v(" 就一定是性能最好的，当同时又很多请求涌来时，把所有进程激活性能可能会比单个排序唤醒更好。")])]),s._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[e("p",[e("code",[s._v("multi_accept : on | off 默认 off;")]),s._v(" 设置工作进程是否可以同时接收多个进程")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("worker_connections : 512(默认) ;")]),s._v(" 配置单个 worker 进程的最大连接数")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("use")]),s._v(" 设置 nginx 选择哪种事件驱动来处理网络消息")])])]),s._v(" "),e("div",{staticClass:"language-config line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("events{\n    accept_mutex on;\n    multi_accept on;\n    worker_connections 1024 ;\n    use epoll ;\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("我们可以在"),e("code",[s._v("nginx.conf")]),s._v("增加以上的代码来配置"),e("code",[s._v("events")]),s._v("模块")]),s._v(" "),e("h2",{attrs:{id:"http-配置模块"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#http-配置模块"}},[s._v("#")]),s._v(" http 配置模块")]),s._v(" "),e("ol",[e("li",[e("code",[s._v("MIME-Type")]),s._v(" 指定请求的文件类型")])]),s._v(" "),e("p",[e("code",[s._v("default_type")]),s._v(" 默认的文件文件类型 ，在 nginx"),e("code",[s._v("localtion")]),s._v(" 下增加以下的配置来测试不同的类型")]),s._v(" "),e("div",{staticClass:"language-config line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("location /get_text {\n    default_type text/plain ;\n    return 200 '<h1>this is text</h1>';\n}\n\nlocation /get_html {\n    default_type text/html ;\n    return 200 '<h1>this is html</h1>';\n}\n\nlocation /get_json {\n    default_type application/json ;\n    return 200 '{\"name\":\"张三 \"}';\n}\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("h2",{attrs:{id:"自定义服务日志"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#自定义服务日志"}},[s._v("#")]),s._v(" 自定义服务日志")]),s._v(" "),e("ol",[e("li",[s._v("access.log 访问成功日志")])]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[s._v("语法")]),s._v(" "),e("th",[e("code",[s._v("access_log path [format[buffer=size]]")])])])]),s._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[s._v("默认值")]),s._v(" "),e("td",[s._v("access_log logs/access.log commbined;")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[s._v("位置")]),s._v(" "),e("td",[s._v("http , server , location")])])])]),s._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[s._v("log_format 指定日志输出的格式")])]),s._v(" "),e("p",[s._v("示例")]),s._v(" "),e("div",{staticClass:"language-sh line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[s._v("\nlog_format myforat "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'this log is =====>'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \naccess_log  logs/my-access.log  log_format"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("当我们替换为自己的格式时会发现之前的类似于这样的日志不见了，这是因为默认的输出格式中带了许多的nginx内置变量")]),s._v(" "),e("p",[e("code",[s._v('113.246.108.7 - - [03/Aug/2021:22:45:21 +0800] "GET / HTTP/1.1" 304 0 "http://47.107.81.99/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.107 Safari/537.36 Edg/92.0.902.62"')])])])}),[],!1,null,null,null);n.default=a.exports}}]);